
name: Deploy tolenaar-toto
on:
  push:
    branches: [ main ]

jobs:
  deploy:
    # This tells GitHub to use your NAS container instead of a GitHub-owned server
    runs-on: self-hosted 
    steps:
      - name: Fix Git Permissions
        run: git config --global --add safe.directory /volume1/docker/tolenaar-toto

      - name: Force Update NAS Files
        run: |
          cd /volume1/docker/tolenaar-toto
          # Fetch the latest code without needing a 'checkout' step
          git fetch origin main
          # This wipes any local changes and makes the folder a perfect mirror of GitHub
          git reset --hard origin/main 

      - name: Rebuild and Recreate
        run: |
          cd /volume1/docker/tolenaar-toto
          # Build fresh and force Synology to replace the running container
          docker compose up -d --build --force-recreate